<div class="mat-elevation-z{{matElevationValue}}">

  <div [ngClass]="fixedSize && 'table-container'" style="overflow: auto;">

    <table mat-table class="full-width-table" matSort aria-label="Elements">
      <!-- Order Number Column (string) -->
      <ng-container matColumnDef="orderNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Numer zlecenia</th>
        <td mat-cell *matCellDef="let row">
          <a  mat-button 
              matTooltip="Szczegóły zlecenia" 
              [matTooltipPosition]="'right'" 
              aria-label="Order details" 
              routerLink="/orders/{{row.id}}"  
              color="primary">
              {{row.orderNumber}}
          </a>
        </td>
      </ng-container>
  
      <!-- Created Date Column -->
      <ng-container matColumnDef="createDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Data utworzenia</th>
        <td mat-cell *matCellDef="let row">
          
          <!-- Only date as string -->
          <span *ngIf="row.createdAt">
            {{row.createdAt | date : 'dd.MM.yyyy' }}
          </span>

          <!-- Time icon with tooltip-->
          <mat-icon
            inline
            *ngIf="row.createdAt"
            matTooltip="{{row.createdAt | date : 'HH:mm' }}"
            [matTooltipPosition]="'right'"
          >schedule</mat-icon>
        
        </td>
      </ng-container>

      <!-- Status Change Date Column -->
      <ng-container matColumnDef="finishDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Data zmiany statusu</th>
        <td mat-cell *matCellDef="let row">
           
          <!-- Only date as string -->
          <span *ngIf="row.finishDate">
            {{row.finishDate | date : 'dd.MM.yyyy' }}
          </span>

          <!-- Time icon with tooltip-->
          <mat-icon
            inline
            *ngIf="row.finishDate"
            matTooltip="{{row.finishDate | date : 'HH:mm' }}"
            [matTooltipPosition]="'right'"
          >schedule</mat-icon>

        </td>
      </ng-container>
  
      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let row">
          <app-status-selector 
            (onStatusUpdate)="onStatusUpdate($event)" 
            [status]="row.status">
          </app-status-selector>
        </td>
      </ng-container>

      <!-- Client Column -->
      <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Klient</th>
        <td mat-cell *matCellDef="let row">

          <!-- Client link -->
          <app-client-profile-link [client]="row.client"></app-client-profile-link>
            
          <!-- Otherwise add button -->
          <button mat-stroked-button color="primary" *ngIf="!row.client">Dodaj</button>

        </td>
      </ng-container>

      <!-- Vehicle Column -->
      <ng-container matColumnDef="vehicle">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Pojazd</th>
        <td mat-cell *matCellDef="let row">

          <!-- Link to vehicle -->
          <a *ngIf="row.vehicle"
              matTooltip="Profil pojazdu" 
              [matTooltipPosition]="'right'"
              aria-label="Vehicle profile"
              mat-button 
              routerLink="/vehicles/{{row.vehicle.id}}" 
              color="primary">
            {{row.vehicle.brand}} {{row.vehicle.model}}
          </a>
          <!-- Otherwise add button -->
          <button mat-stroked-button color="primary" *ngIf="!row.vehicle">Dodaj</button>

        </td>
      </ng-container>

      <!-- Admission Date Column -->
      <ng-container matColumnDef="admissionDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Dostarczenie auta</th>
        <td mat-cell *matCellDef="let row">

          <!-- Date and Time picker -->
          <app-date-and-time-picker
            (dateChange)="onAdmissionDateChange($event, row.id)"
            [initialDate]="row.admissionDate" >
          </app-date-and-time-picker>

        </td>
      </ng-container>

      <!-- Deadline Date Column -->
      <ng-container matColumnDef="deadlineDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Termin naprawy</th>
        <td mat-cell *matCellDef="let row">
        
           <!-- Date and Time picker -->
          <app-date-and-time-picker 
            (dateChange)="onDeadlineDateChange($event, row.id)"
            [initialDate]="row.deadlineDate" >
          </app-date-and-time-picker>

        </td>
      </ng-container>

      <!-- Total Gross Column -->
      <ng-container matColumnDef="totalGross">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Kwota do zapłaty</th>
        <td mat-cell *matCellDef="let row">{{ row.totalGross | number : '1.2-2'}} zł</td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Operacje</th>
        <td mat-cell *matCellDef="let row">

          <!-- Invoice -->
          <button mat-icon-button 
                  color="primary"
                  aria-label="Invoice button" 
                  matTooltip="Wystaw fakturę" 
                  [matTooltipPosition]="'left'" 
          >    

            <mat-icon>receipt_long</mat-icon>
          </button>

          <!-- Delete -->
          <button mat-icon-button 
                  color="warn" 
                  aria-label="Delete button"
                  matTooltip="Usuń zlecenie" 
                  [matTooltipPosition]="'right'"
          >
            <mat-icon>delete_forever</mat-icon>
          </button>

        </td>
      </ng-container>

  
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true;"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- Row shown when there is no data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell"  [ngStyle]="{border: '0px'}" colspan="10" >
          <div class="no-orders-message">
            <mat-icon>leaderboard</mat-icon>
            <div>
              Brak zleceń
            </div>
          </div>
        </td>
      </tr>

    </table>
  </div>

  <!-- Pagination -->
  <mat-paginator #paginator
      [length]="dataSource?.data?.length"
      [pageIndex]="0"
      [pageSize]="8"
      [pageSizeOptions]="[8, 12, 16]"
      aria-label="Wybierz stronę">
  </mat-paginator>
</div>
