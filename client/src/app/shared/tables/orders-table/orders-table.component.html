<div class="mat-elevation-z{{ matElevationValue }}">
  <div [ngClass]="fixedSize && 'table-container'" style="overflow: auto">
    <table *ngIf="dataSource" mat-table class="full-width-table" matSort aria-label="Elements">
      <!-- Order Number Column (string) -->
      <ng-container matColumnDef="orderNumber">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Order No.</th>
        <td mat-cell *matCellDef="let row">
          <a
            mat-button
            matTooltip="Order details"
            [matTooltipPosition]="'right'"
            aria-label="Order details"
            routerLink="/orders/{{ row.id }}"
            color="primary"
          >
            {{ row.orderNumber }}
          </a>
        </td>
      </ng-container>

      <!-- Created Date Column -->
      <ng-container matColumnDef="createDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Created date</th>
        <td mat-cell *matCellDef="let row">
          <!-- Date as string -->
          <span #createdAtDate class="createdAtDate" *ngIf="row.createdAt && !shrinkDates">
            {{ row.createdAt | date : "dd.MM.yyyy" }}
          </span>
          <!-- Icon with tooltip-->
          <mat-icon
            inline
            [ngClass]="{ 'big-clock': shrinkDates, 'disabled-clock': !row.createdAt }"
            matTooltip="{{ row.createdAt | date : (shrinkDates ? 'dd.MM.yyyy, HH:mm' : 'HH:mm') }}"
            [matTooltipPosition]="'right'"
            >schedule</mat-icon
          >
        </td>
      </ng-container>

      <!-- Status Change Date Column -->
      <ng-container matColumnDef="finishDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status changed</th>
        <td mat-cell *matCellDef="let row">
          <!-- Date as string -->
          <span #statusChangeDate class="statusChangeDate" *ngIf="row.finishDate && !shrinkDates">
            {{ row.finishDate | date : "dd.MM.yyyy" }}
          </span>
          <!-- Icon with tooltip-->
          <mat-icon
            inline
            [ngClass]="{ 'big-clock': shrinkDates, 'disabled-clock': !row.finishDate }"
            matTooltip="{{ row.finishDate | date : (shrinkDates ? 'dd.MM.yyyy, HH:mm' : 'HH:mm') }}"
            [matTooltipPosition]="'right'"
            >schedule</mat-icon
          >
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let row">
          <app-status-selector (onStatusUpdate)="onStatusUpdate($event)" [status]="row.status">
          </app-status-selector>
        </td>
      </ng-container>

      <!-- Client Column -->
      <ng-container matColumnDef="client">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Client</th>
        <td mat-cell *matCellDef="let row">
          <!-- Client link -->
          <app-client-profile-link [client]="row.client"></app-client-profile-link>
        </td>
      </ng-container>

      <!-- Vehicle Column -->
      <ng-container matColumnDef="vehicle">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Vehicle</th>
        <td mat-cell *matCellDef="let row">
          <!-- Link to vehicle -->
          <app-vehicle-profile-link *ngIf="row.vehicle" [vehicle]="row.vehicle">
          </app-vehicle-profile-link>
        </td>
      </ng-container>

      <!-- Admission Date Column -->
      <ng-container matColumnDef="admissionDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Admission date</th>
        <td mat-cell *matCellDef="let row">
          <!-- Date and Time picker -->
          <app-date-and-time-picker
            (dateChange)="onDateUpdate($event, row.id, 'admission')"
            [initialDate]="row.admissionDate"
          >
          </app-date-and-time-picker>
        </td>
      </ng-container>

      <!-- Deadline Date Column -->
      <ng-container matColumnDef="deadlineDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Deadline</th>
        <td mat-cell *matCellDef="let row">
          <!-- Date and Time picker -->
          <app-date-and-time-picker
            (dateChange)="onDateUpdate($event, row.id, 'deadline')"
            [initialDate]="row.deadlineDate"
          >
          </app-date-and-time-picker>
        </td>
      </ng-container>

      <!-- Total Gross Column -->
      <ng-container matColumnDef="totalGross">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Cost</th>
        <td mat-cell *matCellDef="let row">
          {{ row.totalGross | number : "1.2-2" }} <span class="currency-suffix">PLN</span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let row">
          <!-- Expand button -->
          <button
            mat-icon-button
            [matMenuTriggerFor]="actions"
            color="primary"
            aria-label="Expand acctions"
          >
            <mat-icon>expand_more</mat-icon>
          </button>

          <!-- Actions -->
          <mat-menu #actions="matMenu">
            <button
              mat-menu-item
              [disabled]="!(row.status.position === 3 || row.status.position === 4)"
              aria-label="Invoice"
            >
              <mat-icon>receipt_long</mat-icon><span>Invoice</span>
            </button>

            <button mat-menu-item (click)="onDeleteClick(row)" aria-label="Delete">
              <mat-icon color="warn">delete_forever</mat-icon
              ><span class="delete-text">Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- Row shown when there is no data -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [ngStyle]="{ border: '0px' }" colspan="10">
          <div class="no-orders-message">
            <mat-icon>leaderboard</mat-icon>
            <div>Brak zleceń</div>
          </div>
        </td>
      </tr>
    </table>
  </div>

  <!-- Pagination -->
  <mat-paginator
    #paginator
    [length]="dataSource?.data?.length"
    [pageIndex]="0"
    [pageSize]="8"
    [pageSizeOptions]="[8, 12, 16]"
    aria-label="Wybierz stronę"
  >
  </mat-paginator>
</div>
